<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morse Code Translator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .navigation {
            background: #34495e;
            padding: 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: transparent;
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .nav-btn.active {
            background: rgba(255,255,255,0.2);
            border-bottom-color: #667eea;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .translator {
            padding: 40px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-section label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Courier New', monospace;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .clear-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .clear-btn:hover {
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .history-section {
            background: #f0f8ff;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 2px solid #e6f3ff;
        }

        .history-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3rem;
        }

        .history-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .history-controls button {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            border-radius: 10px;
        }

        .history-item {
            background: white;
            border: 1px solid #e0e6ed;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .history-type {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .history-time {
            color: #666;
            font-size: 0.8rem;
        }

        .history-content {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            word-break: break-all;
        }

        .history-input {
            border-left: 4px solid #667eea;
        }

        .history-output {
            border-left: 4px solid #28a745;
        }

        .history-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .history-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .history-btn:hover {
            background: #5a6268;
        }

        .no-history {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        .morse-reference {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .morse-reference h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3rem;
        }

        .morse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .morse-item {
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e0e6ed;
        }

        .morse-item .letter {
            font-weight: bold;
            color: #2c3e50;
        }

        .morse-item .code {
            color: #667eea;
            font-weight: 600;
        }

        .status {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .translator {
                padding: 20px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì° Morse Code Translator</h1>
            <p>Convert text to Morse code and back with audio playback</p>
        </div>
        
        <div class="navigation">
            <button class="nav-btn active" onclick="showPage('textToMorse')">üìù Text ‚Üí Morse</button>
            <button class="nav-btn" onclick="showPage('morseToText')">üî§ Morse ‚Üí Text</button>
            <button class="nav-btn" onclick="showPage('history')">üìö History</button>
            <button class="nav-btn" onclick="showPage('reference')">üìã Reference</button>
        </div>

        <!-- Text to Morse Page -->
        <div id="textToMorse" class="page active">
            <div class="translator">
                <div class="input-section">
                    <label for="textInput">Text Input:</label>
                    <textarea id="textInput" placeholder="Enter text to convert to Morse code..."></textarea>
                </div>
                
                <div class="controls">
                    <button onclick="convertTextToMorse()">Convert to Morse</button>
                    <button onclick="playMorseFromText()">üîä Play Morse</button>
                    <button onclick="clearTextToMorse()" class="clear-btn">Clear</button>
                </div>
                
                <div id="textToMorseStatus" class="status" style="display: none;"></div>
                
                <div class="input-section">
                    <label for="textMorseOutput">Morse Code Output:</label>
                    <textarea id="textMorseOutput" placeholder="Morse code will appear here..." readonly></textarea>
                </div>
            </div>
        </div>

        <!-- Morse to Text Page -->
        <div id="morseToText" class="page">
            <div class="translator">
                <div class="input-section">
                    <label for="morseInput">Morse Code Input:</label>
                    <textarea id="morseInput" placeholder="Enter Morse code (use spaces between letters, / between words)..."></textarea>
                </div>
                
                <div class="controls">
                    <button onclick="convertMorseToText()">Convert to Text</button>
                    <button onclick="readTextFromMorse()">üó£Ô∏è Read Text</button>
                    <button onclick="clearMorseToText()" class="clear-btn">Clear</button>
                </div>
                
                <div id="morseToTextStatus" class="status" style="display: none;"></div>
                
                <div class="input-section">
                    <label for="morseTextOutput">Text Output:</label>
                    <textarea id="morseTextOutput" placeholder="Converted text will appear here..." readonly></textarea>
                </div>
            </div>
        </div>

        <!-- History Page -->
        <div id="history" class="page">
            <div class="translator">
                <div class="history-section">
                    <h3>üìö Translation History</h3>
                    <div class="history-controls">
                        <button onclick="clearHistory()" class="clear-btn">Clear History</button>
                        <button onclick="exportHistory()">üì• Export History</button>
                    </div>
                    <div id="historyList" class="history-list">
                        <p class="no-history">No translations yet. Start converting to build your history!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reference Page -->
        <div id="reference" class="page">
            <div class="translator">
                <div class="morse-reference">
                    <h3>üìã Morse Code Reference</h3>
                    <div class="morse-grid" id="morseGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Morse code dictionary
        const morseCode = {
            'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.',
            'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..',
            'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.',
            'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-',
            'Y': '-.--', 'Z': '--..', '0': '-----', '1': '.----', '2': '..---',
            '3': '...--', '4': '....-', '5': '.....', '6': '-....', '7': '--...',
            '8': '---..', '9': '----.', ' ': '/', '.': '.-.-.-', ',': '--..--',
            '?': '..--..', "'": '.----.', '!': '-.-.--', '/': '-..-.', '(': '-.--.',
            ')': '-.--.-', '&': '.-...', ':': '---...', ';': '-.-.-.', '=': '-...-',
            '+': '.-.-.', '-': '-....-', '_': '..--.-', '"': '.-..-.', '$': '...-..-',
            '@': '.--.-.'
        };

        // Reverse dictionary for Morse to text conversion
        const reverseMorseCode = Object.fromEntries(
            Object.entries(morseCode).map(([key, value]) => [value, key])
        );

        // History management
        let translationHistory = JSON.parse(localStorage.getItem('morseHistory') || '[]');

        // Initialize the reference grid
        function initializeMorseGrid() {
            const grid = document.getElementById('morseGrid');
            Object.entries(morseCode).forEach(([letter, code]) => {
                if (letter !== ' ') { // Skip space character in reference
                    const item = document.createElement('div');
                    item.className = 'morse-item';
                    item.innerHTML = `<div class="letter">${letter}</div><div class="code">${code}</div>`;
                    grid.appendChild(item);
                }
            });
        }

        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        function addToHistory(input, output, type) {
            const historyItem = {
                id: Date.now(),
                input: input,
                output: output,
                type: type,
                timestamp: new Date().toLocaleString()
            };
            
            translationHistory.unshift(historyItem);
            
            // Keep only last 50 translations
            if (translationHistory.length > 50) {
                translationHistory = translationHistory.slice(0, 50);
            }
            
            localStorage.setItem('morseHistory', JSON.stringify(translationHistory));
            displayHistory();
        }

        function displayHistory() {
            const historyList = document.getElementById('historyList');
            
            if (translationHistory.length === 0) {
                historyList.innerHTML = '<p class="no-history">No translations yet. Start converting to build your history!</p>';
                return;
            }
            
            historyList.innerHTML = translationHistory.map(item => `
                <div class="history-item">
                    <div class="history-header">
                        <span class="history-type">${item.type}</span>
                        <span class="history-time">${item.timestamp}</span>
                    </div>
                    <div class="history-content history-input">
                        <strong>Input:</strong> ${item.input || 'Empty'}
                    </div>
                    <div class="history-content history-output">
                        <strong>Output:</strong> ${item.output || 'Empty'}
                    </div>
                    <div class="history-actions">
                        <button class="history-btn" onclick="reloadTranslation('${item.id}')">üîÑ Reload</button>
                        <button class="history-btn" onclick="deleteHistoryItem('${item.id}')">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function reloadTranslation(id) {
            const item = translationHistory.find(h => h.id == id);
            if (item) {
                document.getElementById('textInput').value = item.type === 'Text ‚Üí Morse' ? item.input : item.output;
                document.getElementById('morseOutput').value = item.type === 'Text ‚Üí Morse' ? item.output : item.input;
                showStatus('Translation reloaded successfully!');
            }
        }

        function deleteHistoryItem(id) {
            translationHistory = translationHistory.filter(h => h.id != id);
            localStorage.setItem('morseHistory', JSON.stringify(translationHistory));
            displayHistory();
            showStatus('History item deleted!');
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear all translation history?')) {
                translationHistory = [];
                localStorage.removeItem('morseHistory');
                displayHistory();
                showStatus('History cleared successfully!');
            }
        }

        function exportHistory() {
            if (translationHistory.length === 0) {
                showStatus('No history to export!', 'error');
                return;
            }
            
            const exportData = translationHistory.map(item => 
                `${item.timestamp} - ${item.type}\nInput: ${item.input}\nOutput: ${item.output}\n${'='.repeat(50)}`
            ).join('\n\n');
            
            const blob = new Blob([exportData], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `morse-history-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('History exported successfully!');
        }

        function textToMorse() {
            const textInput = document.getElementById('textInput').value.toUpperCase();
            const morseOutput = document.getElementById('morseOutput');
            
            if (!textInput.trim()) {
                showStatus('Please enter some text to convert!', 'error');
                return;
            }
            
            let morse = '';
            for (let char of textInput) {
                if (morseCode[char]) {
                    morse += morseCode[char] + ' ';
                } else if (char === ' ') {
                    morse += '/ ';
                } else {
                    morse += '? '; // Unknown character
                }
            }
            
            const result = morse.trim();
            morseOutput.value = result;
            
            // Add to history
            addToHistory(textInput, result, 'Text ‚Üí Morse');
            
            showStatus('Text converted to Morse code successfully!');
        }

        function morseToText() {
            const morseInput = document.getElementById('morseOutput').value;
            const textOutput = document.getElementById('textInput');
            
            if (!morseInput.trim()) {
                showStatus('Please enter Morse code to convert!', 'error');
                return;
            }
            
            const morseWords = morseInput.split(' / ');
            let text = '';
            
            for (let word of morseWords) {
                const morseChars = word.trim().split(' ');
                for (let morseChar of morseChars) {
                    if (morseChar.trim()) {
                        if (reverseMorseCode[morseChar]) {
                            text += reverseMorseCode[morseChar];
                        } else {
                            text += '?'; // Unknown Morse code
                        }
                    }
                }
                text += ' ';
            }
            
            const result = text.trim();
            textOutput.value = result;
            
            // Add to history
            addToHistory(morseInput, result, 'Morse ‚Üí Text');
            
            showStatus('Morse code converted to text successfully!');
        }

        // Audio context for Morse code playback
        let audioContext;
        let isPlaying = false;
        let isReading = false;

        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        function playBeep(frequency = 600, duration = 200) {
            return new Promise((resolve) => {
                const ctx = initAudioContext();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.frequency.setValueAtTime(frequency, ctx.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration / 1000);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + duration / 1000);
                
                setTimeout(resolve, duration);
            });
        }

        async function playMorse() {
            if (isPlaying) {
                showStatus('Already playing! Please wait...', 'error');
                return;
            }

            const textInput = document.getElementById('textInput').value.trim();
            
            if (!textInput) {
                showStatus('Please enter some text to play as Morse code!', 'error');
                return;
            }

            isPlaying = true;
            const playButton = document.querySelector('button[onclick="playMorse()"]');
            const originalText = playButton.textContent;
            playButton.textContent = '‚è∏Ô∏è Playing...';
            playButton.disabled = true;

            try {
                // Initialize audio context (required for user interaction)
                await initAudioContext().resume();
                
                showStatus('üîä Playing Morse code with real audio!', 'success');
                
                const morseOutput = document.getElementById('morseOutput');
                const originalBg = morseOutput.style.backgroundColor;
                
                // Convert text to morse and play
                const text = textInput.toUpperCase();
                
                for (let i = 0; i < text.length; i++) {
                    const char = text[i];
                    
                    if (morseCode[char]) {
                        const morse = morseCode[char];
                        
                        // Highlight current character being played
                        morseOutput.style.backgroundColor = '#FFE4B5';
                        
                        for (let j = 0; j < morse.length; j++) {
                            const signal = morse[j];
                            
                            if (signal === '.') {
                                // Dot: short beep (200ms)
                                morseOutput.style.backgroundColor = '#90EE90';
                                await playBeep(600, 200);
                                morseOutput.style.backgroundColor = '#FFE4B5';
                                await new Promise(resolve => setTimeout(resolve, 100)); // Short pause
                            } else if (signal === '-') {
                                // Dash: long beep (600ms)
                                morseOutput.style.backgroundColor = '#FFB6C1';
                                await playBeep(600, 600);
                                morseOutput.style.backgroundColor = '#FFE4B5';
                                await new Promise(resolve => setTimeout(resolve, 100)); // Short pause
                            }
                        }
                        
                        // Pause between letters
                        morseOutput.style.backgroundColor = originalBg;
                        await new Promise(resolve => setTimeout(resolve, 300));
                        
                    } else if (char === ' ') {
                        // Pause between words (longer)
                        await new Promise(resolve => setTimeout(resolve, 700));
                    }
                }
                
                morseOutput.style.backgroundColor = originalBg;
                showStatus('‚úÖ Morse code playback completed!', 'success');
                
            } catch (error) {
                console.error('Audio playback error:', error);
                showStatus('Audio playback failed. Please try again.', 'error');
            } finally {
                isPlaying = false;
                playButton.textContent = originalText;
                playButton.disabled = false;
            }
        }

        function readText() {
            if (isReading) {
                showStatus('Already reading! Please wait...', 'error');
                return;
            }

            // Check if speech synthesis is supported
            if (!('speechSynthesis' in window)) {
                showStatus('Speech synthesis not supported in this browser!', 'error');
                return;
            }

            let textToRead = '';
            const textInput = document.getElementById('textInput').value.trim();
            const morseInput = document.getElementById('morseOutput').value.trim();

            // Determine what to read
            if (textInput) {
                textToRead = textInput;
            } else if (morseInput) {
                // Convert Morse to text first
                const morseWords = morseInput.split(' / ');
                let convertedText = '';
                
                for (let word of morseWords) {
                    const morseChars = word.trim().split(' ');
                    for (let morseChar of morseChars) {
                        if (morseChar.trim()) {
                            if (reverseMorseCode[morseChar]) {
                                convertedText += reverseMorseCode[morseChar];
                            } else {
                                convertedText += '?';
                            }
                        }
                    }
                    convertedText += ' ';
                }
                textToRead = convertedText.trim();
            }

            if (!textToRead) {
                showStatus('No text to read! Enter text or Morse code first.', 'error');
                return;
            }

            isReading = true;
            const readButton = document.querySelector('button[onclick="readText()"]');
            const originalText = readButton.textContent;
            readButton.textContent = '‚è∏Ô∏è Reading...';
            readButton.disabled = true;

            // Create speech synthesis utterance
            const utterance = new SpeechSynthesisUtterance(textToRead);
            utterance.rate = 0.8; // Slightly slower for clarity
            utterance.pitch = 1;
            utterance.volume = 0.8;

            // Handle speech events
            utterance.onstart = () => {
                showStatus('üó£Ô∏è Reading text aloud...', 'success');
            };

            utterance.onend = () => {
                isReading = false;
                readButton.textContent = originalText;
                readButton.disabled = false;
                showStatus('‚úÖ Text reading completed!', 'success');
            };

            utterance.onerror = (event) => {
                isReading = false;
                readButton.textContent = originalText;
                readButton.disabled = false;
                showStatus('Speech synthesis failed. Please try again.', 'error');
                console.error('Speech synthesis error:', event);
            };

            // Start speaking
            speechSynthesis.speak(utterance);
        }

        function clearAll() {
            document.getElementById('textInput').value = '';
            document.getElementById('morseOutput').value = '';
            
            // Stop any ongoing speech
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
                isReading = false;
                const readButton = document.querySelector('button[onclick="readText()"]');
                readButton.textContent = 'üó£Ô∏è Read Text';
                readButton.disabled = false;
            }
            
            showStatus('All fields cleared!');
        }

        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Add active class to clicked nav button
            event.target.classList.add('active');
        }

        // Status functions for different pages
        function showTextToMorseStatus(message, type = 'success') {
            const status = document.getElementById('textToMorseStatus');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        function showMorseToTextStatus(message, type = 'success') {
            const status = document.getElementById('morseToTextStatus');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        // Text to Morse page functions
        function convertTextToMorse() {
            const textInput = document.getElementById('textInput').value.toUpperCase();
            const morseOutput = document.getElementById('textMorseOutput');
            
            if (!textInput.trim()) {
                showTextToMorseStatus('Please enter some text to convert!', 'error');
                return;
            }
            
            let morse = '';
            for (let char of textInput) {
                if (morseCode[char]) {
                    morse += morseCode[char] + ' ';
                } else if (char === ' ') {
                    morse += '/ ';
                } else {
                    morse += '? '; // Unknown character
                }
            }
            
            const result = morse.trim();
            morseOutput.value = result;
            
            // Add to history
            addToHistory(textInput, result, 'Text ‚Üí Morse');
            
            showTextToMorseStatus('Text converted to Morse code successfully!');
        }

        function playMorseFromText() {
            if (isPlaying) {
                showTextToMorseStatus('Already playing! Please wait...', 'error');
                return;
            }

            const textInput = document.getElementById('textInput').value.trim();
            
            if (!textInput) {
                showTextToMorseStatus('Please enter some text to play as Morse code!', 'error');
                return;
            }

            playMorseAudio(textInput, 'textMorseOutput', showTextToMorseStatus);
        }

        function clearTextToMorse() {
            document.getElementById('textInput').value = '';
            document.getElementById('textMorseOutput').value = '';
            showTextToMorseStatus('Text to Morse fields cleared!');
        }

        // Morse to Text page functions
        function convertMorseToText() {
            const morseInput = document.getElementById('morseInput').value;
            const textOutput = document.getElementById('morseTextOutput');
            
            if (!morseInput.trim()) {
                showMorseToTextStatus('Please enter Morse code to convert!', 'error');
                return;
            }
            
            const morseWords = morseInput.split(' / ');
            let text = '';
            
            for (let word of morseWords) {
                const morseChars = word.trim().split(' ');
                for (let morseChar of morseChars) {
                    if (morseChar.trim()) {
                        if (reverseMorseCode[morseChar]) {
                            text += reverseMorseCode[morseChar];
                        } else {
                            text += '?'; // Unknown Morse code
                        }
                    }
                }
                text += ' ';
            }
            
            const result = text.trim();
            textOutput.value = result;
            
            // Add to history
            addToHistory(morseInput, result, 'Morse ‚Üí Text');
            
            showMorseToTextStatus('Morse code converted to text successfully!');
        }

        function readTextFromMorse() {
            if (isReading) {
                showMorseToTextStatus('Already reading! Please wait...', 'error');
                return;
            }

            // Check if speech synthesis is supported
            if (!('speechSynthesis' in window)) {
                showMorseToTextStatus('Speech synthesis not supported in this browser!', 'error');
                return;
            }

            let textToRead = '';
            const textOutput = document.getElementById('morseTextOutput').value.trim();
            const morseInput = document.getElementById('morseInput').value.trim();

            // Use converted text if available, otherwise convert morse input
            if (textOutput) {
                textToRead = textOutput;
            } else if (morseInput) {
                // Convert Morse to text first
                const morseWords = morseInput.split(' / ');
                let convertedText = '';
                
                for (let word of morseWords) {
                    const morseChars = word.trim().split(' ');
                    for (let morseChar of morseChars) {
                        if (morseChar.trim()) {
                            if (reverseMorseCode[morseChar]) {
                                convertedText += reverseMorseCode[morseChar];
                            } else {
                                convertedText += '?';
                            }
                        }
                    }
                    convertedText += ' ';
                }
                textToRead = convertedText.trim();
                document.getElementById('morseTextOutput').value = textToRead;
            }

            if (!textToRead) {
                showMorseToTextStatus('No text to read! Enter Morse code first.', 'error');
                return;
            }

            readTextAloud(textToRead, showMorseToTextStatus);
        }

        function clearMorseToText() {
            document.getElementById('morseInput').value = '';
            document.getElementById('morseTextOutput').value = '';
            
            // Stop any ongoing speech
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
                isReading = false;
            }
            
            showMorseToTextStatus('Morse to Text fields cleared!');
        }

        // Refactored audio playback function
        async function playMorseAudio(text, outputElementId, statusCallback) {
            isPlaying = true;
            const playButton = event.target;
            const originalText = playButton.textContent;
            playButton.textContent = '‚è∏Ô∏è Playing...';
            playButton.disabled = true;

            try {
                // Initialize audio context (required for user interaction)
                await initAudioContext().resume();
                
                statusCallback('üîä Playing Morse code with real audio!', 'success');
                
                const morseOutput = document.getElementById(outputElementId);
                const originalBg = morseOutput.style.backgroundColor;
                
                // Convert text to morse and play
                const upperText = text.toUpperCase();
                
                for (let i = 0; i < upperText.length; i++) {
                    const char = upperText[i];
                    
                    if (morseCode[char]) {
                        const morse = morseCode[char];
                        
                        // Highlight current character being played
                        morseOutput.style.backgroundColor = '#FFE4B5';
                        
                        for (let j = 0; j < morse.length; j++) {
                            const signal = morse[j];
                            
                            if (signal === '.') {
                                // Dot: short beep (200ms)
                                morseOutput.style.backgroundColor = '#90EE90';
                                await playBeep(600, 200);
                                morseOutput.style.backgroundColor = '#FFE4B5';
                                await new Promise(resolve => setTimeout(resolve, 100)); // Short pause
                            } else if (signal === '-') {
                                // Dash: long beep (600ms)
                                morseOutput.style.backgroundColor = '#FFB6C1';
                                await playBeep(600, 600);
                                morseOutput.style.backgroundColor = '#FFE4B5';
                                await new Promise(resolve => setTimeout(resolve, 100)); // Short pause
                            }
                        }
                        
                        // Pause between letters
                        morseOutput.style.backgroundColor = originalBg;
                        await new Promise(resolve => setTimeout(resolve, 300));
                        
                    } else if (char === ' ') {
                        // Pause between words (longer)
                        await new Promise(resolve => setTimeout(resolve, 700));
                    }
                }
                
                morseOutput.style.backgroundColor = originalBg;
                statusCallback('‚úÖ Morse code playback completed!', 'success');
                
            } catch (error) {
                console.error('Audio playback error:', error);
                statusCallback('Audio playback failed. Please try again.', 'error');
            } finally {
                isPlaying = false;
                playButton.textContent = originalText;
                playButton.disabled = false;
            }
        }

        // Refactored text reading function
        function readTextAloud(text, statusCallback) {
            isReading = true;
            const readButton = event.target;
            const originalText = readButton.textContent;
            readButton.textContent = '‚è∏Ô∏è Reading...';
            readButton.disabled = true;

            // Create speech synthesis utterance
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.8; // Slightly slower for clarity
            utterance.pitch = 1;
            utterance.volume = 0.8;

            // Handle speech events
            utterance.onstart = () => {
                statusCallback('üó£Ô∏è Reading text aloud...', 'success');
            };

            utterance.onend = () => {
                isReading = false;
                readButton.textContent = originalText;
                readButton.disabled = false;
                statusCallback('‚úÖ Text reading completed!', 'success');
            };

            utterance.onerror = (event) => {
                isReading = false;
                readButton.textContent = originalText;
                readButton.disabled = false;
                statusCallback('Speech synthesis failed. Please try again.', 'error');
                console.error('Speech synthesis error:', event);
            };

            // Start speaking
            speechSynthesis.speak(utterance);
        }

        // Initialize the page
        initializeMorseGrid();
        displayHistory();

        // Add real-time conversion on input for text-to-morse page
        document.getElementById('textInput').addEventListener('input', function() {
            if (this.value.trim()) {
                const textInput = this.value.toUpperCase();
                const morseOutput = document.getElementById('textMorseOutput');
                
                let morse = '';
                for (let char of textInput) {
                    if (morseCode[char]) {
                        morse += morseCode[char] + ' ';
                    } else if (char === ' ') {
                        morse += '/ ';
                    } else {
                        morse += '? '; // Unknown character
                    }
                }
                
                morseOutput.value = morse.trim();
            } else {
                document.getElementById('textMorseOutput').value = '';
            }
        });

        // Add real-time conversion on input for morse-to-text page
        document.getElementById('morseInput').addEventListener('input', function() {
            if (this.value.trim()) {
                const morseInput = this.value;
                const textOutput = document.getElementById('morseTextOutput');
                
                const morseWords = morseInput.split(' / ');
                let text = '';
                
                for (let word of morseWords) {
                    const morseChars = word.trim().split(' ');
                    for (let morseChar of morseChars) {
                        if (morseChar.trim()) {
                            if (reverseMorseCode[morseChar]) {
                                text += reverseMorseCode[morseChar];
                            } else {
                                text += '?'; // Unknown Morse code
                            }
                        }
                    }
                    text += ' ';
                }
                
                textOutput.value = text.trim();
            } else {
                document.getElementById('morseTextOutput').value = '';
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9729563e43863bbc',t:'MTc1NTc3MDk4Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
